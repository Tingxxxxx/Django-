# ORMæ¡†æ¶ F è¡¨é”å¼èˆ‡ Q è¡¨é”å¼ ç­†è¨˜

## 1. F è¡¨é”å¼: ç›´æ¥ç”¨æ¬„ä½é‹ç®—
âœ… **èªæ³•: `F('æ¬„ä½åç¨±')`**

- å¯åœ¨æŸ¥è©¢ä¸­ä½¿ç”¨æ¨¡å‹æ¬„ä½çš„å€¼é€²è¡Œè¨ˆç®—ï¼Œè€Œä¸éœ€è¦å°‡å…¶è¼‰å…¥åˆ° Python è¨˜æ†¶é«”ä¸­ã€‚(ä¸éœ€å…ˆæŸ¥å‡ºä¾†->ä¿®æ”¹->å­˜å›è³‡æ–™åº« é€™å€‹éç¨‹)
- é€šå¸¸èˆ‡ **annotate**()ã€**filter()**ã€**exclude()**ã€**update()** ç­‰æ–¹æ³•ä¸€èµ·ä½¿ç”¨ï¼Œé€™æ¨£å¯ä»¥åœ¨è³‡æ–™åº«å±¤é€²è¡Œè¨ˆç®—ï¼Œæ¸›å°‘ä¸å¿…è¦çš„è³‡æ–™å‚³è¼¸ã€‚

âœ… **æ‡‰ç”¨å ´æ™¯:**
- **ç›´æ¥æ›´æ–°æŸæ¬„ä½çš„è³‡æ–™:** ex æŠŠæ¯æœ¬æ›¸çš„priceéƒ½èª¿é«˜100å…ƒ
- **é€²è¡Œæ¬„ä½é–“çš„æ¯”è¼ƒ:** ex: æŸ¥è©¢æŠ˜æ‰£å¾Œçš„åƒ¹æ ¼é«˜æ–¼åŸåƒ¹çš„æ›¸ç±
  
### ç¯„ä¾‹:
```python

# æ¨¡å‹å®šç¾©
from django.db import models

class Author(models.Model):
    """ä½œè€…æ¨¡å‹"""
    name = models.CharField(max_length=100)
    age = models.IntegerField()
    email = models.EmailField()

    class Meta:
        db_table = 'front_author'

class Publisher(models.Model):
    """å‡ºç‰ˆç¤¾æ¨¡å‹"""
    name = models.CharField(max_length=300)

    class Meta:
        db_table = 'front_publisher'

class Book(models.Model):
    """åœ–æ›¸æ¨¡å‹"""
    name = models.CharField(max_length=300)
    pages = models.IntegerField()
    price = models.FloatField()
    discounted_price = models.FloatField()  # æ–°å¢æŠ˜æ‰£å¾Œåƒ¹æ ¼æ¬„ä½
    rating = models.FloatField()
    author = models.ForeignKey(Author, on_delete=models.CASCADE)
    publisher = models.ForeignKey(Publisher, on_delete=models.CASCADE)

    class Meta:
        db_table = 'front_book'

class BookOrder(models.Model):
    """åœ–æ›¸è¨‚å–®æ¨¡å‹"""
    book = models.ForeignKey("Book", on_delete=models.CASCADE)
    price = models.FloatField()

    class Meta:
        db_table = 'front_book_order'

# F è¡¨é”å¼ ä½¿ç”¨ç¯„ä¾‹ç¯„ä¾‹

# ğŸ“Œ æ›´æ–°æ¬„ä½çš„å€¼: æ›´æ–°æ›¸ç±çš„åƒ¹æ ¼ï¼Œå°‡åƒ¹æ ¼æé«˜ 10%
def increase_price(request):
    # ä½¿ç”¨ F è¡¨é”å¼ç›´æ¥æ›´æ¬„æ–°æ¬„ä½è³‡æ–™
    Book.objects.update(price=F('price') * 1.10)
    return JsonResponse({'status': 'price updated'})ã€‚

# ğŸ“Œ æ¬„ä½é–“çš„æ¯”è¼ƒ: æŸ¥è©¢æŠ˜æ‰£å¾Œçš„åƒ¹æ ¼é«˜æ–¼åŸåƒ¹çš„æ›¸ç±
def discounted_books(request):
    # ä½¿ç”¨ F è¡¨é”å¼ä¾†æ¯”è¼ƒæŠ˜æ‰£å¾Œåƒ¹æ ¼èˆ‡åŸåƒ¹
    data = Book.objects.filter(price__lt=F('discounted_price'))  # æŸ¥è©¢æŠ˜æ‰£å¾Œçš„åƒ¹æ ¼é«˜æ–¼åŸåƒ¹çš„æ›¸ç±
    return JsonResponse(list(data.values('id', 'name', 'price', 'discounted_price')), safe=False)
```

## 2. Q è¡¨é”å¼: ç”¨æ–¼è¤‡é›œçš„æ¢ä»¶ç¯©é¸

âœ… **èªæ³•: Q(<æ¢ä»¶>)**

- ä¸€èˆ¬ filter(æ¢ä»¶1,æ¢ä»¶2...)åªèƒ½ç”¨æ–¼ AND é—œä¿‚ï¼Œæ¢ä»¶ä¹‹é–“çš„é—œä¿‚æ˜¯ã€Œä¸”ã€ã€‚
- Qè¡¨é”å¼ å¯ç”¨æ–¼åœ¨æŸ¥è©¢ä¸­å»ºç«‹è¤‡é›œçš„æŸ¥è©¢æ¢ä»¶ï¼Œå°¤å…¶æ˜¯ç•¶æ¢ä»¶ä¹‹é–“éœ€è¦é€²è¡Œé‚è¼¯é‹ç®—ï¼ˆå¦‚ ANDã€ORã€NOT ç­‰ï¼‰æ™‚ã€‚
- å¤šå€‹Q(<æ¢ä»¶>)é–“å¯ç”¨é‹ç®—ç¬¦éš”é–‹ï¼Œ**| ä»£è¡¨ OR** ã€ **& ä»£è¡¨AND**ã€ **~ ä»£è¡¨NOT** ä¾‹å¦‚: `Q(name__icontains="Python") | Q(price__lt=100)`

âœ… æ‡‰ç”¨å ´æ™¯:
- **è¤‡é›œé‚è¼¯æ¢ä»¶çš„ç¯©é¸:** ä¾‹å¦‚ï¼ŒæŸ¥è©¢"åç¨±"åŒ…å«ã€ŒPythonã€æˆ–"åƒ¹æ ¼"ä½æ–¼ 100 å…ƒçš„æ›¸ç±
- **å¤šæ¢ä»¶çš„ OR é‚è¼¯:** ç•¶æ¢ä»¶ä¹‹é–“çš„é—œä¿‚æ˜¯ã€Œæˆ–ã€æ™‚ï¼Œå¯ä»¥ä½¿ç”¨ Q è¡¨é”å¼ä¾†çµ„åˆæ¢ä»¶ã€‚
- **Q çµåˆ F è¡¨é”å¼:** å¯ä»¥å°‡æ¬„ä½ä¹‹é–“çš„è¨ˆç®—èˆ‡é‚è¼¯æ¢ä»¶ç¯©é¸ç›¸çµåˆ

### ç¯„ä¾‹:
```python

from django.db.models import Q

# ğŸ“Œ æŸ¥è©¢åç¨±åŒ…å« "Python" æˆ–åƒ¹æ ¼ä½æ–¼ 100 çš„æ›¸ç±
def search_books(request):
    data = Book.objects.filter(
        # ä½¿ç”¨ | ä»£è¡¨ OR
        Q(name__icontains="Python") | Q(price__lt=100)
        )
    return JsonResponse(list(data.values('id', 'name', 'price')), safe=False)

# Q è¡¨é”å¼ ä½¿ç”¨ç¯„ä¾‹ç¯„ä¾‹

# ğŸ“Œ æŸ¥è©¢åç¨±åŒ…å« "Python" ä¸”åƒ¹æ ¼ä½æ–¼ 100 çš„æ›¸ç±
def search_books(request):
    data = Book.objects.filter(
        # ä½¿ç”¨ & ä½†è¡¨ AND
        Q(name__icontains="Python") & Q(price__lt=100)
        )
    return JsonResponse(list(data.values('id', 'name', 'price')), safe=False)

# ğŸ“Œ æŸ¥è©¢æŠ˜æ‰£å¾Œåƒ¹æ ¼é«˜æ–¼åŸåƒ¹ä¸”è©•åˆ†é«˜æ–¼ 4 çš„æ›¸ç±
def discounted_high_rated_books(request):
    data = Book.objects.filter(
        Q(price__lt=F('discounted_price')) & Q(rating__gt=4)
        )
    return JsonResponse(list(data.values('id', 'name', 'price', 'discounted_price', 'rating')), safe=False)

# ğŸ“Œ æŸ¥è©¢åƒ¹æ ¼ä¸å°æ–¼ 100 çš„æ›¸ç±
def search_books(request):
    data = Book.objects.filter(
        # ä½¿ç”¨ ~ ä»£è¡¨ NOTï¼ŒæŸ¥è©¢åƒ¹æ ¼ä¸å°æ–¼ 100 çš„æ›¸ç±
        ~Q(price__lt=100)
    )
    return JsonResponse(list(data.values('id', 'name', 'price')), safe=False)
```