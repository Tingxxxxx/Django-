# ğŸ” JWTèªè­‰ç­†è¨˜

## ğŸ“˜ JWT æ˜¯ä»€éº¼ï¼Ÿ

JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç¨®é–‹æ”¾æ¨™æº–ï¼ˆRFC 7519ï¼‰ï¼Œç”¨ä¾†åœ¨é›™æ–¹ä¹‹é–“ä»¥ **JSON æ ¼å¼å®‰å…¨å‚³éè³‡è¨Š**ã€‚å®ƒå»£æ³›ç”¨æ–¼å‰å¾Œç«¯åˆ†é›¢å°ˆæ¡ˆçš„ **èº«ä»½é©—è­‰æ©Ÿåˆ¶**ï¼Œç‰¹åˆ¥æ˜¯ **ç„¡ç‹€æ…‹ï¼ˆstatelessï¼‰èªè­‰**ã€‚

### ğŸ”¸ JWT çµæ§‹
JWT é€šå¸¸ç”±ä¸‰éƒ¨åˆ†çµ„æˆï¼Œä»¥ `.` åˆ†éš”ï¼š

- **Header**ï¼šæè¿°ç°½åçš„æ¼”ç®—æ³•ï¼ˆå¦‚ HS256ï¼‰
- **Payload**ï¼šåŒ…å«å¯¦éš›è³‡è¨Šï¼ˆå¦‚ä½¿ç”¨è€… IDã€éæœŸæ™‚é–“ï¼‰ï¼Œä½†ä¸è¦å­˜**å¯†ç¢¼**
- **Signature**ï¼šç”¨å¯†é‘°åŠ å¯†å¾Œçš„ç°½åï¼Œç”¨ä¾†é©—è­‰è³‡æ–™æœªè¢«ç«„æ”¹

#### ç¤ºä¾‹:

```json

# header
{
  'typ': 'JWT',   # è²æ˜é¡å‹
  'alg': 'HS256'  # è²æ˜åŠ å¯†æ–¹å¼
}

ç¶“é`base64`ç®—æ³•ç·¨ç¢¼å¾Œ: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9


# payload
{
  "sub": "1234567890",
  "name": "John Doe",
  "admin": true
}

ç¶“é`base64`ç®—æ³•ç·¨ç¢¼å¾Œ: eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWV9


# signature
1. å°‡ä¸Šé¢å…©éƒ¨åˆ†ä¸­ base64 ç·¨ç¢¼å¾Œçš„å­—ä¸²ç”¨ . é€£æ¥
2. ä½¿ç”¨ Header ä¸­å®£å‘Šçš„åŠ å¯†æ¼”ç®—æ³•ï¼ˆå¦‚ HS256ï¼‰+ secret å¯†é‘°ï¼Œå°ä¸Šè¿°é€£æ¥å­—ä¸²é€²è¡Œç°½ååŠ å¯†
3. æ³¨æ„: secret æ˜¯ä¿å­˜åœ¨ä¼ºæœå™¨ç«¯çš„ï¼ŒJWT çš„ç°½ç™¼èˆ‡ç”Ÿæˆä¹Ÿéƒ½æ˜¯åœ¨ä¼ºæœå™¨ç«¯é€²è¡Œçš„ï¼Œå› æ­¤å®ƒå°±ç›¸ç•¶æ–¼ä½ ä¼ºæœå™¨çš„ç§é‘°ï¼Œåœ¨ä»»ä½•æƒ…æ³ä¸‹éƒ½ä¸æ‡‰è©²å¤–æ´©æˆ–æš´éœ²å‡ºå»ã€‚


HMACSHA256(
  base64UrlEncode(header) + "." + base64UrlEncode(payload), 
  secret
)

çµæœæ ¼å¼: Header.Payload.Signature


```

---

## ğŸŒ ç‚ºä½•åœ¨å‰å¾Œç«¯åˆ†é›¢ä¸­ä½¿ç”¨ JWTï¼Ÿ

å‚³çµ±çš„ Session èªè­‰éœ€è¦åœ¨ä¼ºæœå™¨ç«¯ä¿å­˜ä½¿ç”¨è€…ç‹€æ…‹ï¼ˆSession IDï¼‰ï¼Œè€Œå‰å¾Œç«¯åˆ†é›¢ä¸­å‰ç«¯é€šå¸¸ä¸å…±ç”¨ Cookie æ©Ÿåˆ¶ï¼Œå› æ­¤æ”¹ç”¨ JWT èªè­‰æ–¹å¼ä¾†é”æˆ **ç„¡ç‹€æ…‹èªè­‰**ï¼š

- âœ… ç„¡éœ€åœ¨ä¼ºæœå™¨ç«¯å„²å­˜ Session è³‡æ–™ï¼Œæ¸›è¼•ä¼ºæœå™¨è² æ“”
- âœ… å‰ç«¯å¯å°‡ Token å­˜åœ¨ `localStorage` æˆ– `sessionStorage`
- âœ… æ”¯æ´è·¨å¹³å°ã€è·¨è£ç½®å­˜å–

---

### ğŸ” Token é©—è­‰æµç¨‹è£œå……èªªæ˜

ä¸€èˆ¬æƒ…æ³ä¸‹ï¼Œå‰ç«¯åœ¨ç™¼é€ API è«‹æ±‚æ™‚ï¼Œæœƒåœ¨è«‹æ±‚æ¨™é ­ï¼ˆheaderï¼‰ä¸­åŠ å…¥ `Authorization` æ¬„ä½ï¼Œä¸¦ä½¿ç”¨ `Bearer` å‰ç¶´ä¾†é™„å¸¶ JWTï¼š
####ã€€ç¯„ä¾‹:
```javascript
fetch('/api/user/1', {
  headers: {
    'Authorization': 'Bearer ' + token
  }
})
```
**å¾Œç«¯ä¼ºæœå™¨æ¥æ”¶åˆ°è«‹æ±‚å¾Œï¼Œæœƒå¾ `Authorization` æ¨™é ­ä¸­è§£æå‡º JWTï¼Œæ¥è‘—é€²è¡Œä»¥ä¸‹é©—è­‰ï¼š**

1. é©—è­‰ Token æ˜¯å¦æ­£ç¢ºç°½ç™¼ï¼ˆæ˜¯å¦è¢«ç«„æ”¹ï¼‰

2. é©—è­‰ Token æ˜¯å¦éæœŸ

3. é©—è­‰ Token ä¸­çš„ä½¿ç”¨è€…è³‡è¨Šæ˜¯å¦æœ‰æ•ˆï¼ˆä¾‹å¦‚ user_id æ˜¯å¦å­˜åœ¨ï¼‰

---



## âš™ï¸ DRF å°ˆæ¡ˆä¸­ä½¿ç”¨ JWT çš„æ–¹å¼(åŸºæœ¬æµç¨‹)

### 1ï¸âƒ£ å®‰è£å¿…è¦å¥—ä»¶

å»ºè­°ä½¿ç”¨ **`djangorestframework-simplejwt`**ï¼š

```bash
pip install djangorestframework-simplejwt
```

### 2ï¸âƒ£ è¨­å®š Django å°ˆæ¡ˆçš„`settings.py`
```py
INSTALLED_APPS = [
    ...
    'rest_framework',
    'rest_framework_simplejwt', # æ·»åŠ 
]

REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': (  
        'rest_framework_simplejwt.authentication.JWTAuthentication',  # åœ¨DRFèªè­‰é¡ä¸­æ·»åŠ 
    ),
}

# å¯é¸ï¼šJWT è¨­å®šï¼ˆä¾‹å¦‚éæœŸæ™‚é–“ï¼‰
from datetime import timedelta

SIMPLE_JWT = {
    # è¨ªå•æ¬Šæ–ï¼ˆAccess Tokenï¼‰çš„æœ‰æ•ˆæ™‚é–“ç‚º 15 åˆ†é˜
    'ACCESS_TOKEN_LIFETIME': timedelta(minutes=15),

    # æ›´æ–°æ¬Šæ–ï¼ˆRefresh Tokenï¼‰çš„æœ‰æ•ˆæ™‚é–“ç‚º 1 å¤©
    'REFRESH_TOKEN_LIFETIME': timedelta(days=1),

    # æ˜¯å¦åœ¨æ¯æ¬¡ä½¿ç”¨åˆ·æ–°æ¬Šæ–æ™‚é‡æ–°ç”¢ç”Ÿä¸€å€‹æ–°çš„åˆ·æ–°æ¬Šæ–
    # è¨­ç‚º False è¡¨ç¤ºä¸é‡æ–°ç”¢ç”Ÿ
    'ROTATE_REFRESH_TOKENS': False,

    # ç•¶ ROTATE_REFRESH_TOKENS ç‚º True æ™‚ï¼ŒèˆŠçš„åˆ·æ–°æ¬Šæ–æ˜¯å¦åŠ å…¥é»‘åå–®
    # è¨­ç‚º True è¡¨ç¤ºèˆŠçš„åˆ·æ–°æ¬Šæ–æœƒè¢«å»¢æ£„ï¼ˆé€²å…¥é»‘åå–®ï¼‰
    'BLACKLIST_AFTER_ROTATION': True,
}

# å¦‚æœè¦å•Ÿç”¨ Token é»‘åå–®åŠŸèƒ½ï¼Œé‚„éœ€è¦åœ¨ INSTALLED_APPS ä¸­åŠ å…¥(ç„¶å¾Œåœ¨åŸ·è¡Œé·ç§»)ï¼š
'rest_framework_simplejwt.token_blacklist',

```

### 3ï¸âƒ£ åœ¨ `urls.py` ä¸­ å»ºç«‹ Token API ç«¯é»
```PY
from django.urls import path
from rest_framework_simplejwt.views import (
    TokenObtainPairView,
    TokenRefreshView,
)

urlpatterns = [
    path('api/token/', TokenObtainPairView.as_view(), name='token_obtain_pair'),  # ç™»å…¥å–å¾— access & refresh token
    path('api/token/refresh/', TokenRefreshView.as_view(), name='token_refresh'),  # é‡æ–°å–å¾— access token
]
```

### 4ï¸âƒ£ ç™»å…¥æµç¨‹ï¼ˆå‰ç«¯ï¼‰
1. ä½¿ç”¨è€…è¼¸å…¥å¸³å¯†ç™»å…¥ï¼Œå‰ç«¯ç™¼é€ `POST` è«‹æ±‚åˆ° `/api/token/`
2. å¾Œç«¯å›å‚³ï¼š
```JS
    {
    "access": "JWT_ACCESS_TOKEN",
    "refresh": "JWT_REFRESH_TOKEN"
    }
```
3. å‰ç«¯ä¿å­˜ access tokenï¼ˆé€šå¸¸å­˜åœ¨ localStorageï¼‰

### 5ï¸âƒ£ ä½¿ç”¨ Token è¨ªå•å—ä¿è­·çš„ API
åœ¨ç™¼é€ API è«‹æ±‚æ™‚åœ¨è«‹æ±‚é ­`Header`åŠ å…¥ `Authorization` ï¼š
```HTTP
GET /api/user/profile/
Authorization: Bearer JWT_ACCESS_TOKEN

å¾Œç«¯å³å¯é€é `JWTAuthentication` è§£æå‡ºä½¿ç”¨è€…è³‡è¨Š
```

### 6ï¸âƒ£ Token éæœŸæ™‚ä½¿ç”¨ Refresh Token æ›´æ–°
Tokenéå…¶å¯¦è¨ªå•å¾Œç«¯è·¯ç”±åˆ·æ–°
```HTTP
POST /api/token/refresh/
{
  "refresh": "your_refresh_token"
}
```
--- 

## âš™ï¸ å¯¦éš›æ¥­å‹™ä¸­ JWT çš„å¦ä¸€ç¨®æ‡‰ç”¨æ–¹å¼

é™¤äº†ä½¿ç”¨å…§å»ºçš„ `/api/token/` ç™»å…¥ç²å¾— JWTï¼Œä¹Ÿå¯ä»¥æ ¹æ“šå¯¦éš›éœ€æ±‚ï¼Œè‡ªè¡Œåœ¨å¾Œç«¯è¨»å†Šè¦–åœ–ï¼ˆviewï¼‰ä¾†ç°½ç™¼ tokenï¼Œè®“æµç¨‹æ›´éˆæ´»ã€æ›´è²¼è¿‘æ¥­å‹™é‚è¼¯ã€‚




#### ğŸ”¸ 1. å¾Œç«¯è‡ªè¨‚è¨»å†Šæˆ–ç™»å…¥ API ä¸¦ç°½ç™¼ JWT

å¯ä»¥åœ¨ Django å¾Œç«¯ä¸­ï¼Œé€é `rest_framework_simplejwt.tokens` æ¨¡çµ„æ‰‹å‹•ç”Ÿæˆ tokenï¼Œä¾‹å¦‚ï¼š

```python
from rest_framework.views import APIView
from rest_framework.response import Response
from rest_framework import status
from django.contrib.auth.models import User
from rest_framework_simplejwt.tokens import RefreshToken

class CustomRegisterView(APIView):
    def post(self, request):
        username = request.data.get('username')
        password = request.data.get('password')
        if User.objects.filter(username=username).exists():
            return Response({'error': 'ä½¿ç”¨è€…å·²å­˜åœ¨'}, status=400)
        
        user = User.objects.create_user(username=username, password=password)
        refresh = RefreshToken.for_user(user) # é€™è¡Œä»£ç¢¼æœƒæ ¹æ“šä½¿ç”¨è€…å‰µå»ºä¸€å° JWT token
        # access token æ˜¯ç”¨ä¾†é©—è­‰ç”¨æˆ¶èº«ä»½çš„çŸ­æœŸæœ‰æ•ˆä»¤ç‰Œã€‚
        # refresh token ç”¨ä¾†åœ¨ access token å¤±æ•ˆæ™‚ï¼Œè«‹æ±‚ç²å¾—æ–°çš„ access tokenã€‚
        return Response({
            'access': str(refresh.access_token),
            'refresh': str(refresh),
            'user_id': user.id
        }, status=status.HTTP_201_CREATED)


```

#### ğŸ”¸ 2. å‰ç«¯ä½¿ç”¨æ””æˆªå™¨çµ±ä¸€è™•ç† Token
åœ¨å‰ç«¯ï¼ˆä¾‹å¦‚ä½¿ç”¨ Vue æˆ– Reactï¼‰ï¼Œä½ å¯ä»¥ä½¿ç”¨æ””æˆªå™¨ï¼ˆInterceptorï¼‰å°è£ token çš„åŠ å…¥èˆ‡éŒ¯èª¤è™•ç†ï¼š
```JS
axios.interceptors.request.use(config => {
  const token = localStorage.getItem('access_token');
  if (token) {
    config.headers.Authorization = 'Bearer ' + token;
  }
  return config;
});
```
---
### âœ… è£œå……:
å¯å°è£ä¸€å€‹æ–°å¢äº†**è‡ªå‹•æ·»åŠ TOKEN**ä»¥åŠ**TOKENéæœŸè‡ªå‹•åˆ·æ–°**å…©å€‹åŠŸèƒ½ï¼Œå¯é‡è¤‡ç”¨çš„ Axios å¯¦ä¾‹ï¼ˆä¾‹å¦‚æ–°å¢ä¸€å€‹ http.jsæª”ï¼‰
```js
// http.js
import axios from 'axios';

// å»ºç«‹ axios å¯¦ä¾‹ï¼Œè¨­ç½®åŸºæœ¬é…ç½®ï¼Œå¦‚ baseURL å’Œ timeout
const instance = axios.create({
  baseURL: 'https://your-api-domain.com', // è¨­å®š API ä¼ºæœå™¨çš„åŸºç¤ URLï¼Œé€™è£¡éœ€è¦æ›¿æ›æˆä½ çš„å¾Œç«¯ API ç¶²å€
  timeout: 5000, // è¨­å®šè«‹æ±‚è¶…é 5000 æ¯«ç§’ï¼ˆ5ç§’ï¼‰å°‡è‡ªå‹•ä¸­æ­¢
  headers: {
    'Content-Type': 'application/json', // è¨­å®šé è¨­çš„è«‹æ±‚å…§å®¹é¡å‹ç‚º JSON
  }
});

// ğŸ‘‰ è«‹æ±‚æ””æˆªå™¨ï¼šåœ¨æ¯å€‹è«‹æ±‚ç™¼é€ä¹‹å‰åŸ·è¡Œï¼Œä¸¦è‡ªå‹•å°‡ access token åŠ å…¥ headers
instance.interceptors.request.use(config => {
  // å¾ localStorage ä¸­ç²å–å­˜å„²çš„ access_token
  const token = localStorage.getItem('access_token');
  
  // å¦‚æœ access_token å­˜åœ¨ï¼Œå‰‡å°‡å…¶åŠ åˆ°è«‹æ±‚çš„ headers ä¸­
  if (token) {
    config.headers.Authorization = 'Bearer ' + token;
  }

  // è¿”å›ä¿®æ”¹å¾Œçš„ configï¼Œè®“è«‹æ±‚ç¹¼çºŒç™¼é€
  return config;
}, error => {
  // å¦‚æœè«‹æ±‚éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ï¼Œç›´æ¥è¿”å›éŒ¯èª¤
  return Promise.reject(error);
});

// ğŸ”„ å›æ‡‰æ””æˆªå™¨ï¼šç”¨ä¾†æ””æˆª HTTP å›æ‡‰ï¼Œä¸¦è‡ªå‹•è™•ç† token åˆ·æ–°
instance.interceptors.response.use(
  response => response,  // å¦‚æœå›æ‡‰æˆåŠŸï¼Œç›´æ¥è¿”å›è©²å›æ‡‰è³‡æ–™
  async error => {
    // ç²å–ç•¶å‰è«‹æ±‚çš„åŸå§‹é…ç½®
    const originalRequest = error.config;

    // æª¢æŸ¥éŒ¯èª¤çš„ HTTP ç‹€æ…‹ç¢¼æ˜¯å¦ç‚º 401ï¼Œè¡¨ç¤ºæœªæˆæ¬Šæˆ– token éæœŸ
    // ä¸”è©²è«‹æ±‚æœªæ›¾é€²è¡Œéé‡è©¦
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true; // è¨˜éŒ„è©²è«‹æ±‚å·²ç¶“é‡è©¦éï¼Œé˜²æ­¢ç„¡é™å¾ªç’°é‡è©¦

      try {
        // å¾ localStorage ç²å– refresh token
        const refreshToken = localStorage.getItem('refresh_token');

        // ä½¿ç”¨ refresh token ç™¼é€è«‹æ±‚ä¾†ç²å–æ–°çš„ access token
        const res = await axios.post('/api/token/refresh/', {
          refresh: refreshToken
        });

        // ç²å–æ–°çš„ access token
        const newAccessToken = res.data.access;

        // å°‡æ–°çš„ access token å­˜å„²åˆ° localStorage ä¸­
        localStorage.setItem('access_token', newAccessToken);

        // æ›´æ–°åŸæœ¬çš„è«‹æ±‚çš„ Authorization headerï¼Œä¸¦é‡æ–°ç™¼é€è«‹æ±‚
        originalRequest.headers['Authorization'] = 'Bearer ' + newAccessToken;
        return instance(originalRequest);  // ä½¿ç”¨å°è£çš„ axios å¯¦ä¾‹é‡æ–°ç™¼é€è«‹æ±‚
      } catch (err) {
        console.error('Token åˆ·æ–°å¤±æ•—ï¼Œè«‹é‡æ–°ç™»å…¥');
        // å¦‚æœåˆ·æ–°å¤±æ•—ï¼Œå¯ä»¥æ¸…é™¤ localStorage ä¸­çš„ tokenï¼Œä¸¦å°å‘ç™»å…¥é 
        localStorage.removeItem('access_token');
        localStorage.removeItem('refresh_token');
      }
    }

    // å¦‚æœå‡ºç¾å…¶ä»–éŒ¯èª¤ï¼Œç›´æ¥è¿”å›éŒ¯èª¤
    return Promise.reject(error);
  }
);

// å°å‡ºå°è£å¥½çš„ axios å¯¦ä¾‹ï¼Œè®“å…¶ä»–æª”æ¡ˆå¯ä»¥ä½¿ç”¨
export default instance;

```

âœ… ä½¿ç”¨æ–¹å¼ï¼ˆåœ¨å…¶ä»–æª”æ¡ˆä¸­ï¼‰
```js
// userService.js æˆ–å…ƒä»¶ä¸­
import api from './http';

http.get('/api/user/1')
  .then(res => console.log(res.data))
  .catch(err => console.error(err));
```

```js
// åœ¨ Vue 2 ä¸­å¼•ç”¨å°è£å¥½çš„ axios å¯¦ä¾‹
import api from '@/http';  // å‡è¨­ http.js æ”¾åœ¨ src ç›®éŒ„ä¸‹

export default {
  data() {
    return {
      userData: null,
    };
  },
  created() {
    // åœ¨ Vue çµ„ä»¶ä¸­ä½¿ç”¨ api å¯¦ä¾‹ç™¼é€è«‹æ±‚
    http.get('/some-endpoint')
      .then(response => {
        this.userData = response.data;  // è™•ç†æˆåŠŸå›æ‡‰
      })
      .catch(error => {
        console.error('API è«‹æ±‚å¤±æ•—:', error);  // è™•ç†éŒ¯èª¤
      });
  },
};
```

--- 
## âš¡ JWT ç‚ºä»€éº¼æœƒæœ‰å…©ç¨® Tokenï¼Ÿ


JWT ä¸­æœ‰å…©ç¨®é¡å‹çš„ Tokenï¼Œåˆ†åˆ¥æ˜¯ **Access Token** å’Œ **Refresh Token**ï¼š

| é¡å‹            | ç”¨é€”                        | æœ‰æ•ˆæ™‚é–“ï¼ˆé è¨­ï¼‰ |
|-----------------|-----------------------------|------------------|
| **Access Token** | ç”¨ä¾†é€²è¡Œ API èªè­‰ï¼Œé€šå¸¸æ™‚é–“è¼ƒçŸ­ | 15 åˆ†é˜          |
| **Refresh Token** | ç”¨ä¾†å»¶é•· Access Token çš„æœ‰æ•ˆæœŸ | 1 å¤©             |

### ä¸»è¦åŸå› ï¼š
- **Access Token** ä¸»è¦ç”¨ä¾†é©—è­‰è«‹æ±‚æ˜¯å¦æœ‰æ•ˆï¼Œä½†å®ƒçš„æœ‰æ•ˆæ™‚é–“æ¯”è¼ƒçŸ­ï¼Œé€™æ¨£æœ‰åŠ©æ–¼é™ä½è¢«ç«Šå–å¾Œçš„é¢¨éšªã€‚
- **Refresh Token** å‰‡ç”¨ä¾†åœ¨ Access Token éæœŸå¾Œé‡æ–°æ›å–ä¸€å€‹æ–°çš„ Access Tokenï¼Œé€™æ¨£ç”¨æˆ¶å°±ä¸éœ€è¦æ¯æ¬¡éƒ½é‡æ–°ç™»å…¥ã€‚

---

## ğŸ§± `BLACKLIST_AFTER_ROTATION` - é»‘åå–®æ©Ÿåˆ¶

### ä»€éº¼æ˜¯é»‘åå–®ï¼Ÿ

ã€Œé»‘åå–®ã€æ˜¯ä¸€å€‹è³‡æ–™åº«æˆ–è¨˜éŒ„ï¼Œç”¨ä¾†å„²å­˜é‚£äº›è¢«**å»¢æ­¢ã€ç„¡æ•ˆ**çš„ Tokenã€‚  
ç•¶ Token è¢«åŠ å…¥é»‘åå–®å¾Œï¼Œå®ƒå°±ç„¡æ³•å†ç”¨ä¾†é€²è¡Œèº«ä»½é©—è­‰ï¼Œå³ä¾¿å®ƒçš„æœ‰æ•ˆæœŸå°šæœªçµæŸã€‚

### ä½•æ™‚æœƒç”¨åˆ°é»‘åå–®ï¼Ÿ

- ç•¶é–‹å•Ÿ **Token è¼ªæ›ï¼ˆ`ROTATE_REFRESH_TOKENS=True`ï¼‰** æ™‚ï¼Œæ¯æ¬¡ä½¿ç”¨ **Refresh Token** æ›å–æ–°çš„ **Access Token**ï¼ŒèˆŠçš„ **Refresh Token** æœƒè¢«åŠ å…¥é»‘åå–®ï¼Œç„¡æ³•å†ä½¿ç”¨ã€‚
- é»‘åå–®æ©Ÿåˆ¶çš„ç›®çš„æ˜¯é˜²æ­¢åœ¨ Refresh Token è¢«ç«Šå–çš„æƒ…æ³ä¸‹ï¼Œæ”»æ“Šè€…é‚„èƒ½ç¹¼çºŒä½¿ç”¨é€™äº›èˆŠçš„ Tokenã€‚

### ç‚ºä»€éº¼è¦ä½¿ç”¨é»‘åå–®ï¼Ÿ

- **æé«˜å®‰å…¨æ€§**ï¼šç•¶ç”¨æˆ¶ç™»å‡ºæˆ– Refresh Token è¢«è¼ªæ›æ™‚ï¼Œå°‡èˆŠçš„ Token åŠ å…¥é»‘åå–®ï¼Œä¿è­‰å®ƒå€‘ç„¡æ³•å†è¢«ä½¿ç”¨ã€‚
- **é˜²æ­¢æ»²é€æ”»æ“Š**ï¼šå³ä¾¿æ”»æ“Šè€…ç«Šå–äº†èˆŠçš„ Refresh Tokenï¼ŒèˆŠ Token ä¸€æ—¦åŠ å…¥é»‘åå–®ï¼Œå°±ç„¡æ³•å†ç”¨ä¾†æ›å–æ–°çš„ Access Tokenã€‚

---

## ğŸŒ€ `ROTATE_REFRESH_TOKENS` - è¼ªæ› Refresh Token

ç•¶ `ROTATE_REFRESH_TOKENS=True` æ™‚ï¼Œæ¯æ¬¡ä½¿ç”¨ Refresh Token æ›å–æ–°çš„ Access Token æ™‚ï¼Œæœƒ**åŒæ™‚ç™¼æ”¾ä¸€å€‹æ–°çš„ Refresh Token**ï¼Œä¸¦ä¸”èˆŠçš„ Refresh Token æœƒè¢«æ¨™è¨˜ç‚ºå¤±æ•ˆï¼ŒåŠ å…¥é»‘åå–®ã€‚

é€™æ¨£çš„è¨­å®šæ˜¯ç‚ºäº†æé«˜å®‰å…¨æ€§ï¼Œé˜²æ­¢ Refresh Token è¢«ç«Šå–å¾Œé•·æœŸæœ‰æ•ˆã€‚

---

## ğŸ” ç¸½çµï¼šå…©ç¨® Token å’Œé»‘åå–®çš„ä½œç”¨

1. **Access Token**ï¼šçŸ­æœŸæœ‰æ•ˆï¼Œç”¨æ–¼ API è«‹æ±‚çš„èº«ä»½é©—è­‰ã€‚
2. **Refresh Token**ï¼šç”¨æ–¼å»¶é•· Access Token çš„æœ‰æ•ˆæœŸã€‚
3. **é»‘åå–®**ï¼šç•¶é–‹å•Ÿ Token è¼ªæ›æ™‚ï¼ŒèˆŠçš„ Refresh Token è¢«åŠ å…¥é»‘åå–®ï¼Œç„¡æ³•å†ç”¨ä¾†æ›å–æ–°çš„ Access Tokenï¼Œå¢å¼·ç³»çµ±å®‰å…¨æ€§ã€‚

---

## ğŸ“Š å¯¦å‹™å»ºè­°

| éœ€æ±‚                      | å»ºè­°è¨­å®š                                  |
|---------------------------|-------------------------------------------|
| **ç°¡å–®é©—è­‰ï¼ˆåˆå­¸ã€å€‹äººå°ˆæ¡ˆï¼‰** | ä¸é–‹å•Ÿè¼ªæ›ï¼š`ROTATE_REFRESH_TOKENS = False` |
| **é«˜å®‰å…¨æ€§ï¼ˆæ­£å¼å°ˆæ¡ˆï¼‰**      | é–‹å•Ÿè¼ªæ› + ä½¿ç”¨é»‘åå–®æ©Ÿåˆ¶                |

---

# ğŸ” Django Simple JWT å…§å»ºè¦–åœ–æ•´ç†

## ğŸ“‹ 1. `TokenObtainPairView`

- **ç”¨é€”**ï¼š**ç™»å…¥ç”¨**ï¼Œæäº¤å¸³è™Ÿèˆ‡å¯†ç¢¼ä»¥å–å¾— access token èˆ‡ refresh tokenã€‚(å°±ä¸ç”¨åœ¨è‡ªå·±å¦å¤–å¯«è¦–åœ–)
- **HTTP æ–¹æ³•**ï¼š`POST`
- **é è¨­è·¯ç”±**ï¼š`/api/token/`
- **æœƒå°è³‡æ–™åº«é€²è¡Œå¸³è™Ÿå¯†ç¢¼é©—è­‰**ï¼Œä½¿ç”¨ Django é è¨­çš„å¸³è™Ÿèªè­‰ï¼ˆ`authenticate()` å‡½æ•¸ï¼‰

### âœ… è«‹æ±‚æ ¼å¼ï¼š
```json
{
  "username": "å¸³è™Ÿ",
  "password": "å¯†ç¢¼"
}
```
### ğŸ¯ å›æ‡‰æ ¼å¼
```json
{
  "access": "access.jwt.token",
  "refresh": "refresh.jwt.token"
}
```
---
## ğŸ”„ 2. `TokenRefreshView`
- **ç”¨é€”**ï¼šé€é refresh token æ›å–æ–°çš„ access tokenã€‚
- **HTTP æ–¹æ³•**ï¼šPOST
- **é è¨­è·¯ç”±**ï¼š/api/token/refresh/

### âœ… è«‹æ±‚æ ¼å¼ï¼š
```json
{
  "refresh": "refresh.jwt.token"
}

```
### ğŸ¯ å›æ‡‰æ ¼å¼
```json
{
  "access": "new.access.jwt.token"
}
```
---

## ğŸ” 3. `TokenVerifyView`
- **ç”¨é€”**ï¼šé©—è­‰ access æˆ– refresh token æ˜¯å¦æœ‰æ•ˆï¼ˆå°šæœªéæœŸã€æœªè¢«ç«„æ”¹ï¼‰ã€‚
- **HTTP æ–¹æ³•**ï¼šPOST
- **é è¨­è·¯ç”±**ï¼šé è¨­ç„¡è¨­ç½®è·¯ç”±ï¼Œéœ€æ‰‹å‹•åŠ å…¥ urls.pyï¼š


**urls.pyç¯„ä¾‹:**
```py
from rest_framework_simplejwt.views import TokenVerifyView

urlpatterns = [
    path('api/token/verify/', TokenVerifyView.as_view(), name='token_verify'),
]
```
### âœ… è«‹æ±‚æ ¼å¼ï¼š
```json
{
  "token": "access_or_refresh.jwt.token"
}

```
### ğŸ¯ å›æ‡‰æ ¼å¼
- æˆåŠŸï¼šHTTP 200 OKï¼Œç„¡å…§å®¹
- å¤±æ•—ï¼šå›å‚³éŒ¯èª¤ JSON
---

## ğŸ§¨ 4. `TokenBlacklistView`ï¼ˆéœ€å•Ÿç”¨é»‘åå–®åŠŸèƒ½ï¼‰
- **ç”¨é€”**ï¼šç™»å‡ºæ™‚ä½¿ refresh token ä½œå»¢
- **HTTP æ–¹æ³•**ï¼šPOST
- **éœ€è¦å¦å¤–è¨­å®š`settings.py`èˆ‡`urls.py`**ï¼š
```py
# settings.py
INSTALLED_APPS = [
    ...
    'rest_framework_simplejwt.token_blacklist',
]

# urls.py
from rest_framework_simplejwt.views import TokenBlacklistView

urlpatterns = [
    path('api/token/blacklist/', TokenBlacklistView.as_view(), name='token_blacklist'),
]
```
### âœ… è«‹æ±‚æ ¼å¼ï¼š
```json
{
  "refresh": "refresh.jwt.token"
}

```
### ğŸ¯ å›æ‡‰æ ¼å¼
- æˆåŠŸï¼š
    ```http
    HTTP/1.1 205 Reset Content
    Content-Type: application/json
    ```
    ç„¡å…§å®¹è¿”å›ï¼Œç‹€æ…‹ç¢¼ç‚º `205 Reset Content`ï¼Œè¡¨ç¤ºå®¢æˆ¶ç«¯æ‡‰è©²é‡è¨­è¦–åœ–æˆ–è¡¨å–®ç‹€æ…‹ã€‚
<br>   
- å¤±æ•—ï¼š
    ```http
    HTTP/1.1 401 Unauthorized
    Content-Type: application/json

    {
        "detail": "Token is blacklisted",
        "code": "token_not_valid"
    }
    ```

    æˆ–ï¼š
    ```http
    HTTP/1.1 401 Unauthorized
    Content-Type: application/json

    {
        "detail": "Token is invalid or expired",
        "code": "token_not_valid"
    }
```