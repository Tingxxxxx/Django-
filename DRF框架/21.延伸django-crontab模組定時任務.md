# 🕒 Django Crontab 使用筆記

`django-crontab` 是一個可以讓你在 Django 專案中透過簡單設定來執行定時任務（cron job）的套件，適用於定期執行某些背景任務，如發送通知、清除暫存、備份資料等。

---

## 📦 安裝方式

```bash
pip install django-crontab
```
--- 
## 🧩 設定步驟
### 1. 在 `settings.py` 中加入：加入到 INSTALLED_APPS

```py
INSTALLED_APPS = [
    ...
    'django_crontab',
]
```
### 2. 定義任務（Task）
需要建立一個 Python 函數，作為任務內容，例如在 myapp/cron.py 中：

```py
# myapp/cron.py

def my_scheduled_task():
    print("這是一個排程任務！")
```

### 3. 設定 CRONJOBS
```py
CRONJOBS = [
    ('*/1 * * * *', 'myapp.cron.my_scheduled_task'),
]
```
---
### ⏱️ Cron 語法說明（* * * * *）
Cron 表達式由 5 個欄位組成，每個欄位使用數字或符號來表示時間的頻率。其基本格式如下：

`* * * * *    =>`    分鐘 小時 日 月 星期

| 欄位位置 | 名稱       | 範圍         | 說明             |
| ---- | -------- | ---------- | -------------- |
| 第1欄  | 分鐘（min）  | 0–59       | 幾分執行一次         |
| 第2欄  | 小時（hr）   | 0–23       | 幾點執行一次（24 小時制） |
| 第3欄  | 日（day）   | 1–31       | 每月幾號執行         |
| 第4欄  | 月（month） | 1–12       | 幾月執行一次         |
| 第5欄  | 星期幾（dow） | 0–6（0是星期日） | 每週哪天執行一次       |

<br>

| Cron 表達式      | 解釋                     |
| ------------- | ---------------------- |
| `* * * * *`   | 每分鐘執行一次                |
| `*/5 * * * *` | 每 5 分鐘執行一次             |
| `0 * * * *`   | 每小時的整點執行（如 1:00, 2:00） |
| `0 0 * * *`   | 每天凌晨 00:00 執行一次        |
| `30 7 * * *`  | 每天上午 7:30 執行           |
| `0 12 * * 1`  | 每週一中午 12 點執行           |
| `0 9 * * 1-5` | 每週一至週五上午 9:00 執行（平日排程） |
| `0 0 1 * *`   | 每月 1 號凌晨執行             |
| `0 0 1 1 *`   | 每年 1 月 1 號執行（元旦排程）     |



---
## 🛠️ 管理排程任務指令
### 1.新增排程到系統：
```bash
python manage.py crontab add
```
### 2. 查看當前排程任務（列出所有 crontab ID）：
```bash
python manage.py crontab show
```

### 3. 移除所有排程任務：
```bash
python manage.py crontab remove
```

###　📄 注意事項

- 若有修改 CRONJOBS 設定，請重新執行 crontab add。
- 排程任務的輸出（print、錯誤訊息等）會寫入系統的郵件或 /var/log/syslog，視你的作業系統與設定而定。
- 任務函數中不可使用與 request 有關的物件，因為它是在背景中獨立執行的，無 HTTP 請求上下文。
- 任務如果執行失敗或錯誤，建議可將 log 寫入檔案方便除錯。


