# Django ä½¿ç”¨è¡¨å–®çš„æµç¨‹

## ğŸ“Œ 1. å‰µå»º Forms.py æ–‡ä»¶
Django ä¸­è¡¨å–®é¡ï¼Œéœ€ç¹¼æ‰¿`forms.Form` æˆ– `forms.ModelForm `
- **forms.Form**ç”¨ä¾†å‰µå»ºè‡ªå®šç¾©è¡¨å–®ï¼Œå¯ä»¥è‡ªå®šç¾©è¡¨å–®æ¬„ä½çš„é©—è­‰é‚è¼¯ï¼Œç”¨ä¾†è™•ç†éæ¨¡å‹çš„è¡¨å–®æ•¸æ“šã€‚
- **forms.ModelForm**ç”¨ä¾†åŸºæ–¼ Django æ¨¡å‹è‡ªå‹•ç”Ÿæˆè¡¨å–®ï¼Œä¸¦ä¸”æœƒè‡ªå‹•è™•ç†æ¨¡å‹æ¬„ä½èˆ‡è¡¨å–®æ¬„ä½ä¹‹é–“çš„é©—è­‰æ˜ å°„


#### ç¯„ä¾‹:
```python
from django import forms

# ğŸ“Œ ä½¿ç”¨ forms.Form è‡ªå®šç¾©è¡¨å–®é¡
class ContactForm(forms.Form):
    name = forms.CharField(max_length=100, label='å§“å')
    email = forms.EmailField(label='é›»å­éƒµä»¶')
    message = forms.CharField(widget=forms.Textarea, label='è¨Šæ¯')

# ğŸ“Œ  ä½¿ç”¨ forms.ModelForm ç›´æ¥åŸºæ–¼ Model å»ºç«‹è¡¨å–®
from django import forms
from .models import Contact # å°å…¥æ¨¡å‹

class ContactModelForm(forms.ModelForm):
    class Meta:
        model = Contact  # å°æ‡‰çš„ Model
        fields = ['name', 'email', 'message']
```

## ğŸ“Œ 2. åœ¨ Views.py è™•ç†è¡¨å–®
åœ¨ views.py ä¸­ï¼Œè¡¨å–®çš„è™•ç†åˆ†ç‚ºå…©å€‹ä¸»è¦æ­¥é©Ÿï¼š
- **è¡¨å–®é¡¯ç¤ºï¼ˆGET è«‹æ±‚ï¼‰ï¼š** ç”¨æˆ¶ç¬¬ä¸€æ¬¡åŠ è¼‰é é¢æ™‚ï¼Œæœƒé¡¯ç¤ºç©ºè¡¨å–®ã€‚
- **è¡¨å–®æäº¤ï¼ˆPOST è«‹æ±‚ï¼‰:** ç”¨æˆ¶æäº¤è¡¨å–®å¾Œï¼Œæœƒå°è¡¨å–®æ•¸æ“šé€²è¡Œé©—è­‰ï¼Œä¸¦åŸ·è¡Œç›¸æ‡‰çš„æ“ä½œï¼ˆå¦‚ä¿å­˜æ•¸æ“šã€ç™¼é€éƒµä»¶ç­‰ï¼‰ã€‚

#### ç¯„ä¾‹:
```python
from django.shortcuts import render, redirect
from .forms import ContactForm
from django.views.decorators.http import require_http_methods  # å°å…¥é©—è­‰è£é£¾å™¨

# å®šç¾©è¦–åœ– é¡¯ç¤ºè¡¨å–®ã€æˆ–è™•ç†è¡¨å–®æäº¤çš„æ•¸æ“š

@require_http_methods(['GET','POST']) # é©—è­‰è£é£¾å™¨:é™åˆ¶è¦–åœ–å‡½æ•¸åªèƒ½è™•ç†GETã€POSTè«‹æ±‚
def contact_view(request):
    # å¦‚æœæ˜¯POSTè«‹æ±‚ï¼Œè™•ç†ç”¨æˆ¶æäº¤çš„è¡¨å–®æ•¸æ“š
    if request.method == "POST":
        # è¡¨å–®åˆå§‹åŒ–èˆ‡é©—è­‰
        form = ContactForm(request.POST) # å‰µå»ºä¸€å€‹ ContactForm çš„å¯¦ä¾‹ï¼Œä¸¦å°‡ç”¨æˆ¶æäº¤çš„è³‡æ–™è¼‰å…¥ä¸¦é€²è¡Œé©—è­‰ã€‚
        if form.is_valid(): # is_valid()é©—è­‰æ˜¯å¦ç¬¦åˆè¦æ ¼
            # ç²å–è¡¨å–®æ•¸æ“š
            name = form.cleaned_data.get('name') # æˆ–æ˜¯ name = form.cleaned_data['name']
            email = form.cleaned_data.get('email')
            message = form.cleaned_data.get('message')
            
            # åœ¨é€™è£¡å¯ä»¥åŸ·è¡Œæ¥­å‹™é‚è¼¯ï¼Œå¦‚ä¿å­˜æ•¸æ“šåˆ°å­—æ–™åº«æˆ–ç™¼é€éƒµä»¶
            print(f"æ”¶åˆ°è¡¨å–®ï¼š{name}, {email}, {message}")
            # æˆåŠŸå¾Œé‡å®šå‘è‡³ 'success_page' é é¢
            return redirect('success_page')  # æˆåŠŸå¾Œé‡å®šå‘ï¼Œ'success_page'æ˜¯ä¸€å€‹ URL åç¨±ï¼Œæ‡‰è©²åœ¨ urls.py ä¸­æœ‰å°æ‡‰çš„è·¯ç”±è¨­ç½®ã€‚

        else:
            # è¡¨å–®é©—è­‰å¤±æ•—ï¼Œé‡æ–°æ¸²æŸ“ä¸¦é¡¯ç¤ºéŒ¯èª¤
            return render(request, 'contact.html', {'form': form})

    # å¦‚æœæ˜¯ GET è«‹æ±‚ï¼Œå‰‡é¡¯ç¤ºç©ºè¡¨å–®       
    else:
        form = ContactForm()
    return render(request, 'contact.html', {'form': form})

âœ… `@require_http_methods(['GET','POST'])`: é™åˆ¶åªè™•ç†'GET'ã€'POST'è«‹æ±‚
âœ… `.is_valid()`: æœƒä¾æ“šåœ¨è¡¨å–®é¡ä¸­å®šç¾©çš„æ¬„ä½è¦å‰‡ä¾†é€²è¡Œé©—è­‰
âœ… `.cleaned_data`å±¬æ€§: ç‚ºä¸€å€‹å­—å…¸ï¼ŒåŒ…å«äº†æ‰€æœ‰é€šéé©—è­‰çš„è¡¨å–®æ¬„ä½æ•¸æ“šï¼Œå¯ç”¨get()æ–¹æ³•ï¼Œæˆ–æ˜¯['key']ä¾†å–å€¼
```

## ğŸ“Œ 3. å»ºç«‹è¡¨å–®çš„ HTML æ¨¡æ¿
åœ¨ templates/æ‡‰ç”¨å/contact.html æ–‡ä»¶ä¸­å»ºç«‹è¦æ¸²æŸ“çš„æ¨¡æ¿

```html
ğŸ“Œ é¡¯ç¤ºç©ºè¡¨å–®
<form method="post">
    {% csrf_token %}  <!-- é˜²æ­¢ CSRF æ”»æ“Š -->
    {{ form.as_p }}  <!-- ä»¥ <p> æ¨™ç±¤æ ¼å¼é¡¯ç¤ºè¡¨å–® -->
    <button type="submit">æäº¤</button>
</form>

ğŸ“Œ åœ¨contact.html æ¨¡æ¿ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•ä¾†é¡¯ç¤ºè¡¨å–®çš„éŒ¯èª¤è¨Šæ¯ï¼š
<form method="POST">
    {% csrf_token %}
    {{ form.as_p }}
    
    <!-- é¡¯ç¤ºæ¯å€‹æ¬„ä½çš„éŒ¯èª¤è¨Šæ¯ -->
    {% for field in form %} 
        {% for error in field.errors %}
            <div class="error">{{ error }}</div>
        {% endfor %}
    {% endfor %}

    <button type="submit">æäº¤</button>
</form>
```

## ğŸ“Œ 4. é€²è¡Œ URL è¦–åœ–æ˜ å°„
åœ¨ urls.py ä¸­è¨­å®šå°æ‡‰çš„ URLï¼š
```python
from django.urls import path
from .views import contact_view

urlpatterns = [
    path('contact/', contact_view, name='contact_page'),
]
```

## ğŸ“Œ 5. è¡¨å–®é©—è­‰ is_valid() çš„åŸ·è¡Œé‚è¼¯è§£æ
`is_valid()` æ˜¯ Django è¡¨å–®ä¸­å¸¸ç”¨çš„é©—è­‰æ–¹æ³•ï¼Œå®ƒæœƒé€æ­¥æª¢æŸ¥è¡¨å–®æ¬„ä½çš„æ•¸æ“šï¼Œæ ¹æ“šè¡¨å–®æ¬„ä½çš„è¨­å®šè¦å‰‡é€²è¡Œé©—è­‰

**1. åˆå§‹åŒ–è¡¨å–®æ•¸æ“š:**
- Django æœƒæ ¹æ“šç”¨æˆ¶æäº¤çš„è¡¨å–®æ•¸æ“šï¼ˆå¦‚ **request.POST**ï¼‰ä¾†åˆå§‹åŒ–è¡¨å–®ã€‚
- å¦‚æœæœ‰æª”æ¡ˆä¸Šå‚³ï¼Œå‰‡æœƒä½¿ç”¨ **request.FILES**ã€‚

**2. é€ä¸€é©—è­‰è¡¨å–®æ¬„ä½æ˜¯å¦ç¬¦åˆè¨­å®šçš„é©—è­‰æ¢ä»¶:**
- required=Trueï¼šæª¢æŸ¥æ¬„ä½æ˜¯å¦ç‚ºå¿…å¡«é …ã€‚
- max_lengthï¼šæª¢æŸ¥å­—å…ƒé•·åº¦æ˜¯å¦è¶…éæœ€å¤§é™åˆ¶ã€‚
- EmailFieldï¼šæª¢æŸ¥æ˜¯å¦ç¬¦åˆæ­£ç¢ºçš„é›»å­éƒµä»¶æ ¼å¼ã€‚


**3. è‡ªå®šç¾©é©—è­‰:**
- å¦‚æœæ¬„ä½å®šç¾©äº† clean_<field_name>() æ–¹æ³•ï¼ŒDjango æœƒèª¿ç”¨é€™å€‹æ–¹æ³•ä¾†é€²è¡Œè‡ªå®šç¾©çš„é©—è­‰ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥æª¢æŸ¥æŸå€‹æ¬„ä½çš„å€¼æ˜¯å¦ç¬¦åˆç‰¹å®šæ ¼å¼æˆ–æ¢ä»¶ã€‚

âœ… **è‹¥è¦è‡ªå®šç¾©é©—è­‰ï¼Œå¯ä»¥è¦†å¯« clean_<field_name>() æ–¹æ³•ï¼š**
```python
    class ContactForm(forms.Form):
        name = forms.CharField(max_length=100, label='å§“å')
        email = forms.EmailField(label='é›»å­éƒµä»¶')
        message = forms.CharField(widget=forms.Textarea, label='è¨Šæ¯')
        
        def clean_email(self):
            email = self.cleaned_data.get('email')
            if not email.endswith('@example.com'):
                raise forms.ValidationError("åƒ…å…è¨± example.com çš„éƒµä»¶")
            return email

 ```

 âœ… **è‹¥è¦é©—è­‰å¤šå€‹æ¬„ä½ï¼Œå¯ä»¥ç›´æ¥è¦†å¯«clean() æ–¹æ³•ï¼š**
```python
    class RegisterForm(forms.Form): 
        # è¨­å®šå¯†ç¢¼ï¼Œéœ€ä»‹æ–¼ 8 åˆ° 20 å­—å…ƒï¼Œä¸¦ä½¿ç”¨ PasswordInput è®“è¼¸å…¥ç‚ºå¯†ç¢¼æ ¼å¼
        pwd1 = forms.CharField(min_length=8, max_length=20, widget=forms.PasswordInput, label="å¯†ç¢¼")
        # ç¢ºèªå¯†ç¢¼ï¼Œèˆ‡ pwd1 éœ€ç›¸åŒ
        pwd2 = forms.CharField(min_length=8, max_length=20, widget=forms.PasswordInput, label="ç¢ºèªå¯†ç¢¼")

        # è¤‡å¯« clean() æ–¹æ³•ï¼Œç”¨æ–¼é©—è­‰å…©æ¬¡å¯†ç¢¼æ˜¯å¦ä¸€è‡´
        def clean(self):
            cleaned_data = super().clean()  # èª¿ç”¨çˆ¶é¡ clean() æ–¹æ³•ï¼Œç²å–æ¸…ç†å¾Œçš„è³‡æ–™
            pwd1 = cleaned_data.get('pwd1')  # å–å¾—ç¬¬ä¸€å€‹å¯†ç¢¼
            pwd2 = cleaned_data.get('pwd2')  # å–å¾—ç¬¬äºŒå€‹å¯†ç¢¼

            # æª¢æŸ¥å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼æ˜¯å¦ä¸€è‡´
            if pwd1 and pwd2 and pwd1 != pwd2:
                raise forms.ValidationError('é©—è­‰å¤±æ•—ï¼Œè¼¸å…¥çš„å…©æ¬¡å¯†ç¢¼ä¸åŒ') 
            else:
                return cleaned_data  # è¿”å›é©—è­‰å¾Œçš„è³‡æ–™
```

**4. æ¸…ç†æ•¸æ“š:**
- é©—è­‰æˆåŠŸå¾Œï¼ŒDjango æœƒè‡ªå‹•èª¿ç”¨æ¬„ä½çš„ **clean()** æ–¹æ³•ä¾†æ¸…ç†æ•¸æ“šï¼Œä¾‹å¦‚**å»é™¤ç©ºæ ¼**æˆ–è½‰æ›ç‚º**æ¨™æº–æ ¼å¼**ï¼ˆå¦‚å°‡é›»å­éƒµä»¶è½‰æ›ç‚ºå°å¯«ï¼‰ã€‚

**5. è¿”å›çµæœ:**
- å¦‚æœæ‰€æœ‰æ¬„ä½éƒ½é€šéé©—è­‰ï¼Œis_valid() æœƒè¿”å› Trueï¼Œä¸¦ä¸”å¯ä»¥é€šé **.cleaned_data** å±¬æ€§ä¾†å–å¾—è™•ç†éçš„æœ‰æ•ˆæ•¸æ“šã€‚
- å¦‚æœé©—è­‰å¤±æ•—ï¼Œis_valid() æœƒè¿”å› Falseï¼Œä¸¦ä¸”è¡¨å–®çš„ **.errors** å±¬æ€§æœƒåŒ…å«å„å€‹æ¬„ä½çš„éŒ¯èª¤è¨Šæ¯ã€‚
    - âœ… `.errors`: è¿”å›ä¸€å€‹å­—å…¸ï¼Œä¸”é€™å€‹å±¬æ€§åŒ…å«è¡¨å–®ä¸­æ‰€æœ‰æ¬„ä½çš„éŒ¯èª¤è¨Šæ¯ã€‚
    - âœ… `.errors.get_json_data()`: å¯ç²å–åˆ°å­—å…¸é¡å‹çš„éŒ¯èª¤è¨Šæ¯
    - âœ… `.errors.as_json()`: å°‡éŒ¯èª¤è¨Šæ¯è½‰æ›æˆ JSON æ ¼å¼çš„å­—ä¸²
    - ä»¥ä¸Šè¿”å›çš„çµæœç¯„ä¾‹:
    ```python
            {
            "pwd2": [
                {
                    "message": "é©—è­‰å¤±æ•—ï¼Œè¼¸å…¥çš„å…©æ¬¡å¯†ç¢¼ä¸åŒ",
                    "code": "invalid" # è¡¨ç¤ºè©²æ¬„ä½çš„æ•¸æ“šç„¡æ•ˆ
                }
            ]
        }
    ```

## ğŸ“Œ 6. Django è¡¨å–®å¸¸ç”¨çš„é©—è­‰é¸æ“‡å™¨ï¼ˆValidatorsï¼‰
Django æä¾›äº†ä¸€äº›å…§å»ºçš„é©—è­‰å™¨ï¼ˆvalidatorsï¼‰ï¼Œå¯ä»¥ç›´æ¥ç”¨ä¾†é©—è­‰è¼¸å…¥æ•¸æ“šçš„æ ¼å¼ã€é•·åº¦ã€ç¯„åœç­‰ã€‚å¦‚æœé è¨­é©—è­‰ä¸å¤ ï¼Œé‚„å¯ä»¥è‡ªå®šç¾©é©—è­‰å™¨ã€‚

- `MaxLengthValidator`: é™åˆ¶æœ€å¤§å­—å…ƒæ•¸	
- `MinLengthValidator`: é™åˆ¶æœ€å°å­—å…ƒæ•¸	
- `MaxValueValidator`: é™åˆ¶æ•¸å€¼ä¸Šé™	
- `MinValueValidator`: é™åˆ¶æ•¸å€¼ä¸‹é™	
- `EmailValidator`: é©—è­‰æ˜¯å¦ç‚ºæœ‰æ•ˆçš„ Email æ ¼å¼	
- `URLValidator`: é©—è­‰ç¶²å€æ ¼å¼	
- `RegexValidator`: ä½¿ç”¨æ­£å‰‡è¡¨é”å¼é©—è­‰

#### ç¯„ä¾‹:
```python
from django import forms
from django.core.validators import MaxLengthValidator, MinLengthValidator, RegexValidator, MinValueValidator, EmailValidator

class UserForm(forms.Form):
    # å®šç¾©ä¸€å€‹ "username" æ¬„ä½ï¼Œé™åˆ¶æœ€å¤§é•·åº¦ç‚º 30ï¼Œä¸¦ä½¿ç”¨é¡å¤–çš„é©—è­‰å™¨
    username = forms.CharField(
        max_length=30,  # æœ€å¤§å­—å…ƒæ•¸ç‚º 30
        validators=[
            MinLengthValidator(3, message="ç”¨æˆ¶åè‡³å°‘è¦ 3 å€‹å­—å…ƒ"),  # é™åˆ¶æœ€å°å­—å…ƒæ•¸ç‚º 3
            RegexValidator(r'^[a-zA-Z0-9_]+$', message="åªèƒ½åŒ…å«å­—æ¯ã€æ•¸å­—å’Œåº•ç·š")  # æ­£å‰‡é©—è­‰åªèƒ½åŒ…å«è‹±æ–‡å­—æ¯ã€æ•¸å­—å’Œåº•ç·š
        ],
        label="ç”¨æˆ¶å"  # è¨­å®šæ¨™ç±¤ï¼Œæœƒé¡¯ç¤ºåœ¨å‰ç«¯è¡¨å–®
    )

    # å®šç¾©ä¸€å€‹ "age" æ¬„ä½ï¼Œé™åˆ¶æœ€å°å¹´é½¡ç‚º 18 æ­²
    age = forms.IntegerField(
        validators=[MinValueValidator(18, message="å¹´é½¡å¿…é ˆå¤§æ–¼ 18 æ­²")],  # é™åˆ¶å¹´é½¡è‡³å°‘ç‚º 18 æ­²
        label="å¹´é½¡"
    )

    # å®šç¾©ä¸€å€‹ "email" æ¬„ä½ï¼Œä½¿ç”¨ Django å…§å»ºçš„ EmailValidator ä¾†é©—è­‰é›»å­éƒµä»¶æ ¼å¼
    email = forms.EmailField(
        validators=[EmailValidator(message="è«‹è¼¸å…¥æœ‰æ•ˆçš„é›»å­éƒµä»¶")],  # ç¢ºä¿è¼¸å…¥çš„æ ¼å¼ç‚ºæœ‰æ•ˆ Email
        label="é›»å­éƒµä»¶"
    )
```