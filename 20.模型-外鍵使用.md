# Django å¤–éµï¼ˆForeignKeyï¼‰ç­†è¨˜

## ğŸ“Œ 1. ä»€éº¼æ˜¯å¤–éµï¼Ÿ

å¤–éµï¼ˆForeignKeyï¼‰æ˜¯ç”¨ä¾†å»ºç«‹å…©å€‹è³‡æ–™è¡¨ä¹‹é–“çš„é—œè¯ï¼Œé€šå¸¸ç”¨æ–¼ **ä¸€å°å¤šï¼ˆOne-to-Manyï¼‰** çš„é—œä¿‚ã€‚  
ä¾‹å¦‚ï¼šä¸€å€‹ä½¿ç”¨è€…å¯ä»¥ç™¼ä½ˆå¤šç¯‡æ–‡ç« ï¼Œä½†ä¸€ç¯‡æ–‡ç« åªèƒ½å±¬æ–¼ä¸€å€‹ä½¿ç”¨è€…ã€‚

---

## ğŸ—‚ï¸ 2. å¤–éµçš„åŸºæœ¬èªæ³•

```python
from django.db import models

# ä½¿ç”¨è€…æ¨¡å‹
class User(models.Model):
    username = models.CharField(max_length=50)
    password = models.CharField(max_length=100)

# æ–‡ç« æ¨¡å‹ï¼Œé€é ForeignKey é—œè¯åˆ° User
class Article(models.Model):
    title = models.CharField(max_length=100)
    content = models.TextField()

    # æ­¤è¡Œ Django æœƒè‡ªå‹•åœ¨ Article æ¨¡å‹ä¸­å‰µå»ºä¸€å€‹ author_id æ¬„ä½ã€‚é€™å€‹æ¬„ä½å°æ‡‰åˆ° User æ¨¡å‹çš„ä¸»éµ
    author = models.ForeignKey('User', on_delete=models.CASCADE,related_name='articles')  # è¨­å®šå¤–éµ
```
âœ… å¤–éµåƒæ•¸èªªæ˜ï¼š
- 'User'ï¼šæŒ‡å®šé—œè¯çš„æ¨¡å‹ï¼Œå¯ä»¥ç›´æ¥ç”¨å­—ä¸²è¡¨ç¤ºæ¨¡å‹åç¨±ã€‚
- on_delete=models.CASCADEï¼šç•¶ User è¢«åˆªé™¤æ™‚ï¼Œç›¸é—œè¯çš„ - Article ä¹Ÿæœƒè¢«è‡ªå‹•åˆªé™¤ã€‚
- related_name:å®šç¾©åå‘æŸ¥è©¢çš„åç¨±ï¼Œå¯é€šé user.articles.all() å–å¾—è©²ä½¿ç”¨è€…æ‰€æ’°å¯«çš„æ‰€æœ‰æ–‡ç« 
- å¦‚æœä¸å®šç¾© related_nameï¼Œå‰‡é è¨­ç‚ºæ¨¡å‹åç¨±å°å¯«_setä¾†ç²å–ï¼Œä¾‹å¦‚: user.article_set.all() 
- to_field å¯ä»¥æŒ‡å®šå¤–éµå°æ‡‰çš„æ¬„ä½ï¼Œä¸ä¸€å®šè¦id

## âš¡ 3. on_delete çš„å¸¸è¦‹é¸é …
- **CASCADE**  
  åˆªé™¤çˆ¶ç´šè³‡æ–™æ™‚ï¼Œå­ç´šè³‡æ–™ä¹Ÿä¸€ä½µåˆªé™¤ï¼ˆå¸¸ç”¨ï¼‰ã€‚

- **PROTECT**  
  é˜»æ­¢åˆªé™¤çˆ¶ç´šè³‡æ–™ï¼Œè‹¥æœ‰é—œè¯è³‡æ–™æœƒå ±éŒ¯ã€‚

- **SET_NULL**  
  åˆªé™¤çˆ¶ç´šè³‡æ–™æ™‚ï¼Œå°‡å­ç´šçš„å¤–éµæ¬„ä½è¨­ç‚º `NULL`ï¼ˆéœ€å…è¨± `null=True`ï¼‰ã€‚

- **SET_DEFAULT**  
  åˆªé™¤çˆ¶ç´šè³‡æ–™æ™‚ï¼Œå°‡å¤–éµè¨­ç‚ºé è¨­å€¼ï¼ˆéœ€è¨­ `default` å€¼ï¼‰ã€‚

- **DO_NOTHING**  
  åˆªé™¤çˆ¶ç´šè³‡æ–™æ™‚ä¸åšä»»ä½•è™•ç†ï¼Œå¯èƒ½æœƒå°è‡´è³‡æ–™ä¸ä¸€è‡´ã€‚

- **.SET()**  
  å…è¨±å‚³å…¥ä¸€å€‹ callableï¼ˆä¾‹å¦‚å‡½æ•¸æˆ– lambdaï¼‰ï¼Œä¾†åœ¨çˆ¶ç´šè³‡æ–™è¢«åˆªé™¤æ™‚è‡ªè¨‚å­è³‡æ–™çš„å¤–éµå€¼ã€‚

## ğŸ“„ 4. å…¶ä»–æ³¨æ„äº‹é …

- **å¦‚æœé—œè¯çš„æ¨¡å‹æ˜¯åœ¨å…¶ä»– app ä¸­**  
  ç•¶åœ¨ä¸€å€‹ app ä¸­å»ºç«‹å¤–éµé—œè¯æ™‚ï¼Œè‹¥é€™å€‹é—œè¯çš„æ¨¡å‹æ˜¯åœ¨å…¶ä»– app ä¸­ï¼Œéœ€è¦ä½¿ç”¨æ¨¡å‹åç¨±çš„ã€Œappåç¨±.æ¨¡å‹åç¨±ã€æ ¼å¼ä¾†å¼•ç”¨ã€‚

  ä¾‹å¦‚ï¼Œå¦‚æœ `User` æ¨¡å‹åœ¨ `accounts` app ä¸­ï¼Œå‰‡å¯ä»¥é€™æ¨£å¯«ï¼š

```python
    author = models.ForeignKey('accounts.User', on_delete=models.CASCADE)
```

- **å¦‚æœé—œè¯çš„æ¨¡å‹æ˜¯è‡ªå·±æœ¬èº«**  
    æ¨¡å‹çš„å¤–éµå¼•ç”¨åˆ°è‡ªèº«ï¼Œé€™ç¨®æƒ…æ³å¸¸è¦‹æ–¼éœ€è¦å¯¦ç¾éšå±¤çµæ§‹çš„æƒ…å¢ƒï¼Œä¾‹å¦‚è©•è«–å€ä¸­çš„äºŒç´šè©•è«–ã€‚

    ä¾‹å¦‚ï¼Œè©•è«–å€äºŒç´šè©•è«–ï¼Œå‰‡å¯ä»¥é€™æ¨£å¯«ï¼š
```python
    class Comment(models.Model):
        content = models.TextField()
        created_at = models.DateTimeField(auto_now_add=True)
        origin_comment = models.ForeignKey('self', on_delete=models.CASCADE, null=True, blank=True, related_name='replies')
        author = models.ForeignKey('User', on_delete=models.CASCADE)  # å¯ä»¥è¨­ç½®å…¶ä»–æ¬„ä½ï¼Œå¦‚ä½œè€…ç­‰

        def __str__(self):
            return self.content
```

## ğŸ” 5. å¤–éµå¦‚ä½•ç²å–å…·é«”çš„è³‡æ–™
**1. å–å¾—å¤–éµå°æ‡‰çš„è³‡æ–™ï¼ˆæ­£å‘æŸ¥è©¢ï¼‰:**
```python
  user = User.objects.create(username='alice', password='1234')
  article = Article.objects.create(title='Django å¤–éµæ•™å­¸', content='å…§å®¹...', author=user)
  
  article = Article.objects.get(id=1) 
  # ç›´æ¥é€éå¤–éµæ¬„ä½ author å–å¾—é—œè¯çš„ User ç‰©ä»¶
  print(article.author.username)  # è¼¸å‡ºï¼šalice
```
**2. åå‘æŸ¥è©¢é—œè¯è³‡æ–™ï¼ˆä½¿ç”¨ related_nameï¼‰:**
```python
  user = User.objects.get(username='alice')
  # å–å¾—ä½œè€…'alice'æ’°å¯«çš„æ‰€æœ‰æ–‡ç« ï¼š
  articles = user.articles.all()  # å› ç‚º related_name='articles',å¦‚æœä¸è¨­å®šå‰‡æ˜¯article_set

  for article in articles:
    print(article.title)
```

**3. é›™ä¸‹åŠƒç·šï¼ˆ__ï¼‰è·¨æ¨¡å‹ç¯©é¸æ•¸æ“š:**

âœ… ä½¿ç”¨æ¢ä»¶ï¼š
- å¿…é ˆæ˜¯å¤–éµæ¬„ä½æˆ– JSON æ¬„ä½ æ‰èƒ½ä½¿ç”¨ __ é€²è¡Œè·¨æ¬„ä½æŸ¥è©¢ã€‚
- ç”¨æ–¼è·¨æ¨¡å‹æŸ¥è©¢ï¼š ä¾‹å¦‚ author__username
- ç”¨æ–¼æŸ¥è©¢ç¯©é¸æ¢ä»¶ï¼š ä¾‹å¦‚ title__icontains

âœ…å¸¸ç”¨æŸ¥è©¢æ¢ä»¶ï¼š
* **__icontains:**	ä¸å€åˆ†å¤§å°å¯«æ¨¡ç³ŠåŒ¹é…	
* **__contains:**	å€åˆ†å¤§å°å¯«æ¨¡ç³ŠåŒ¹é…	
* **__exact:**	å®Œå…¨åŒ¹é…
* **__iexact:**	ä¸å€åˆ†å¤§å°å¯«çš„å®Œå…¨åŒ¹é…	
* **__gte:**	å¤§æ–¼ç­‰æ–¼d
* **__lte:**	å°æ–¼ç­‰æ–¼
* **__in:**	æŸ¥è©¢æ˜¯å¦åœ¨æŸå€‹åˆ—è¡¨ä¸­	
* **__isnull:**	æŸ¥è©¢æ˜¯å¦ç‚º 
* **__startswith:**	ä»¥æŒ‡å®šå­—ä¸²é–‹é ­	
* **__endswith:**	ä»¥æŒ‡å®šå­—ä¸²çµå°¾

ğŸ“‹ ç¯„ä¾‹ç¨‹å¼ç¢¼ï¼š
```python
# æŸ¥è©¢æ‰€æœ‰ç”± "alice" æ’°å¯«çš„æ–‡ç« 
user = User.objects.get(username='alice')  
articles = Article.objects.filter(author__username='alice')  

for article in articles:
    print(article.title)

# æŸ¥è©¢æ¨™é¡ŒåŒ…å« "Django" çš„æ–‡ç« ï¼ˆä¸å€åˆ†å¤§å°å¯«ï¼‰
articles = Article.objects.filter(title__icontains='Django')

for article in articles:
    print(article.title)
```